/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";function e(){var n,t,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(e,o,a,i){var c=o&&o.prototype instanceof s?o:s,l=Object.create(c.prototype);return r(l,"_invoke",function(e,r,o){var a,i,c,s=0,l=o||[],f=!1,p={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,r){return a=e,i=0,c=n,p.n=r,u}};function d(e,r){for(i=e,c=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,a=l[t],d=p.p,v=a[2];e>3?(o=v===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=d&&((o=e<2&&d<a[1])?(i=0,p.v=r,p.n=a[1]):d<v&&(o=e<3||a[0]>r||r>v)&&(a[4]=e,a[5]=r,p.n=v,i=0))}if(o||e>1)return u;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),i=l,c=v;(t=i<2?n:c)||!f;){a||(i?i<3?(i>1&&(p.n=-1),d(i,c)):p.n=c:p.v=c);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((t=(f=p.n<0)?c:e.call(r,p))!==u)break}catch(e){a=n,i=1,c=e}finally{s=1}}return{value:t,done:f}}}(e,a,i),!0),l}var u={};function s(){}function l(){}function f(){}t=Object.getPrototypeOf;var p=[][a]?t(t([][a]())):(r(t={},a,function(){return this}),t),d=f.prototype=s.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,r(d,"constructor",f),r(f,"constructor",l),l.displayName="GeneratorFunction",r(f,i,"GeneratorFunction"),r(d),r(d,i,"Generator"),r(d,a,function(){return this}),r(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:v}})()}function r(e,n,t,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,n,t,o){function i(n,t){r(e,n,function(e){return this._invoke(n,t,e)})}n?a?a(e,n,{value:t,enumerable:!o,configurable:!o,writable:!o}):e[n]=t:(i("next",0),i("throw",1),i("return",2))},r(e,n,t,o)}function n(e,r,n,t,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function t(e){return function(){var r=this,t=arguments;return new Promise(function(o,a){var i=e.apply(r,t);function c(e){n(i,o,a,c,u,"next",e)}function u(e){n(i,o,a,c,u,"throw",e)}c(void 0)})}}function o(e,r){return a.apply(this,arguments)}function a(){return a=t(e().m(function r(n,t){var o,a,i,c=arguments;return e().w(function(e){for(;;)switch(e.n){case 0:return o=c.length>2&&void 0!==c[2]?c[2]:1e5,a=new TextEncoder,e.n=1,window.crypto.subtle.importKey("raw",a.encode(n),{name:"PBKDF2"},!1,["deriveKey"]);case 1:return i=e.v,e.a(2,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:o,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]))}},r)})),a.apply(this,arguments)}function i(e,r){return c.apply(this,arguments)}function c(){return(c=t(e().m(function r(n,t){var o,a,i;return e().w(function(e){for(;;)switch(e.n){case 0:return o=new TextEncoder,a=window.crypto.getRandomValues(new Uint8Array(12)),e.n=1,window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,o.encode(t));case 1:return i=e.v,e.a(2,{iv:Array.from(a),ciphertext:Array.from(new Uint8Array(i))})}},r)}))).apply(this,arguments)}function u(e,r,n){return s.apply(this,arguments)}function s(){return(s=t(e().m(function r(n,t,o){var a,i,c,u;return e().w(function(e){for(;;)switch(e.n){case 0:return a=new TextDecoder,i=new Uint8Array(o),c=new Uint8Array(t),e.n=1,window.crypto.subtle.decrypt({name:"AES-GCM",iv:c},n,i);case 1:return u=e.v,e.a(2,a.decode(u))}},r)}))).apply(this,arguments)}function l(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,t,o,a){var u=t&&t.prototype instanceof c?t:c,s=Object.create(u.prototype);return f(s,"_invoke",function(n,t,o){var a,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,n){return a=r,c=0,u=e,p.n=n,i}};function d(n,t){for(c=n,u=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],d=p.p,v=a[2];n>3?(o=v===t)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,p.v=t,p.n=a[1]):d<v&&(o=n<3||a[0]>t||t>v)&&(a[4]=n,a[5]=t,p.n=v,c=0))}if(o||n>1)return i;throw f=!0,t}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(r=c<2?e:u)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((r=(f=p.n<0)?u:n.call(t,p))!==i)break}catch(r){a=e,c=1,u=r}finally{s=1}}return{value:r,done:f}}}(n,o,a),!0),s}var i={};function c(){}function u(){}function s(){}r=Object.getPrototypeOf;var p=[][t]?r(r([][t]())):(f(r={},t,function(){return this}),r),d=s.prototype=c.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,f(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return u.prototype=s,f(d,"constructor",s),f(s,"constructor",u),u.displayName="GeneratorFunction",f(s,o,"GeneratorFunction"),f(d),f(d,o,"Generator"),f(d,t,function(){return this}),f(d,"toString",function(){return"[object Generator]"}),(l=function(){return{w:a,m:v}})()}function f(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,r,n,t){function a(r,n){f(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},f(e,r,n,t)}function p(e,r,n,t,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function d(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function i(e){p(a,t,o,i,c,"next",e)}function c(e){p(a,t,o,i,c,"throw",e)}i(void 0)})}}var v="vault",h="settings";function y(){return m.apply(this,arguments)}function m(){return(m=d(l().m(function e(){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,r){var n=indexedDB.open("secure-shelf-db",1);n.onerror=function(e){r("Error opening database: "+e.target.error)},n.onsuccess=function(r){e(r.target.result)},n.onupgradeneeded=function(e){var r=e.target.result;r.objectStoreNames.contains(v)||r.createObjectStore(v,{keyPath:"id"}),r.objectStoreNames.contains(h)||r.createObjectStore(h,{keyPath:"id"})}}))},e)}))).apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return(b=d(l().m(function e(r){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,t){var o=n.transaction([v],"readwrite"),a=o.objectStore(v).put(r);a.onsuccess=function(){e()},a.onerror=function(e){t("Error saving to vault: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=d(l().m(function e(r){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,t){var o=n.transaction([v],"readonly"),a=o.objectStore(v).get(r);a.onsuccess=function(r){e(r.target.result)},a.onerror=function(e){t("Error retrieving from vault: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function S(){return O.apply(this,arguments)}function O(){return(O=d(l().m(function e(){var r;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return r=e.v,e.a(2,new Promise(function(e,n){var t=r.transaction([v],"readonly"),o=t.objectStore(v).getAll();o.onsuccess=function(r){e(r.target.result)},o.onerror=function(e){n("Error retrieving all from vault: "+e.target.error)},t.oncomplete=function(){r.close()}}))}},e)}))).apply(this,arguments)}function E(e){return j.apply(this,arguments)}function j(){return j=d(l().m(function e(r){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,t){var o=n.transaction([h],"readwrite"),a=o.objectStore(h).put(r);a.onsuccess=function(){e()},a.onerror=function(e){t("Error saving settings: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)})),j.apply(this,arguments)}function P(e){return T.apply(this,arguments)}function T(){return(T=d(l().m(function e(r){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,t){var o=n.transaction([h],"readonly"),a=o.objectStore(h).get(r);a.onsuccess=function(r){e(r.target.result)},a.onerror=function(e){t("Error retrieving settings: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function M(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return L(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function L(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function x(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,t,o,a){var u=t&&t.prototype instanceof c?t:c,s=Object.create(u.prototype);return A(s,"_invoke",function(n,t,o){var a,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,n){return a=r,c=0,u=e,p.n=n,i}};function d(n,t){for(c=n,u=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],d=p.p,v=a[2];n>3?(o=v===t)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,p.v=t,p.n=a[1]):d<v&&(o=n<3||a[0]>t||t>v)&&(a[4]=n,a[5]=t,p.n=v,c=0))}if(o||n>1)return i;throw f=!0,t}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(r=c<2?e:u)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((r=(f=p.n<0)?u:n.call(t,p))!==i)break}catch(r){a=e,c=1,u=r}finally{s=1}}return{value:r,done:f}}}(n,o,a),!0),s}var i={};function c(){}function u(){}function s(){}r=Object.getPrototypeOf;var l=[][t]?r(r([][t]())):(A(r={},t,function(){return this}),r),f=s.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,A(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,A(f,"constructor",s),A(s,"constructor",u),u.displayName="GeneratorFunction",A(s,o,"GeneratorFunction"),A(f),A(f,o,"Generator"),A(f,t,function(){return this}),A(f,"toString",function(){return"[object Generator]"}),(x=function(){return{w:a,m:p}})()}function A(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}A=function(e,r,n,t){function a(r,n){A(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},A(e,r,n,t)}function _(e,r,n,t,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function G(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function i(e){_(a,t,o,i,c,"next",e)}function c(e){_(a,t,o,i,c,"throw",e)}i(void 0)})}}var I="vault-metadata",C="vault-salt",U=null,N=!0,D=null;function F(){return(F=G(x().m(function e(r){var n,t,a,c;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=window.crypto.getRandomValues(new Uint8Array(16)),e.n=1,E({id:C,salt:Array.from(n)});case 1:return t={id:I,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),version:1},e.n=2,o(r,n);case 2:return U=e.v,e.n=3,i(U,JSON.stringify(t));case 3:return a=e.v,e.n=4,g({id:I,data:a});case 4:return N=!1,e.a(2,!0);case 5:return e.p=5,c=e.v,console.error("Error initializing vault:",c),e.a(2,!1)}},e,null,[[0,5]])}))).apply(this,arguments)}function V(){return(V=G(x().m(function e(){var r;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,w(I);case 1:return r=e.v,e.a(2,!!r);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])}))).apply(this,arguments)}function B(e){return J.apply(this,arguments)}function J(){return J=G(x().m(function e(r){var n,t,a,c,s,l,f,p,d=arguments;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:5,e.p=1,e.n=2,P(C);case 2:if(t=e.v){e.n=3;break}return e.a(2,!1);case 3:return a=new Uint8Array(t.salt),e.n=4,o(r,a);case 4:return U=e.v,e.n=5,w(I);case 5:if(c=e.v){e.n=6;break}return e.a(2,!1);case 6:return e.p=6,e.n=7,u(U,c.data.iv,c.data.ciphertext);case 7:return s=e.v,JSON.parse(s),(l=JSON.parse(s)).lastAccessed=(new Date).toISOString(),e.n=8,i(U,JSON.stringify(l));case 8:return f=e.v,e.n=9,g({id:I,data:f});case 9:return N=!1,n>0&&(D&&clearTimeout(D),D=setTimeout(function(){z()},60*n*1e3)),e.a(2,!0);case 10:return e.p=10,e.v,e.a(2,!1);case 11:return e.p=11,p=e.v,console.error("Error unlocking vault:",p),e.a(2,!1);case 12:return e.a(2)}},e,null,[[6,10],[1,11]])})),J.apply(this,arguments)}function z(){U=null,N=!0,D&&(clearTimeout(D),D=null)}function R(){return N}function K(e){return W.apply(this,arguments)}function W(){return(W=G(x().m(function e(r){var n,t;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!N&&U){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,r.id||(r.id="cred-"+Date.now()+"-"+Math.floor(1e3*Math.random())),r.createdAt=(new Date).toISOString(),r.updatedAt=(new Date).toISOString(),e.n=2,i(U,JSON.stringify(r));case 2:return n=e.v,e.n=3,g({id:r.id,url:r.url,username:r.username,data:n});case 3:return e.a(2,r.id);case 4:throw e.p=4,t=e.v,console.error("Error adding credential:",t),t;case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function q(e){return $.apply(this,arguments)}function $(){return($=G(x().m(function e(r){var n,t,o;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!N&&U){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,w(r);case 2:if(n=e.v){e.n=3;break}return e.a(2,null);case 3:return e.n=4,u(U,n.data.iv,n.data.ciphertext);case 4:return t=e.v,e.a(2,JSON.parse(t));case 5:throw e.p=5,o=e.v,console.error("Error getting credential:",o),o;case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}function H(){return Q.apply(this,arguments)}function Q(){return(Q=G(x().m(function e(){var r,n,t,o,a,i,c,s,l;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!N&&U){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,S();case 2:r=e.v,n=[],t=M(r),e.p=3,t.s();case 4:if((o=t.n()).done){e.n=9;break}if((a=o.value).id!==I){e.n=5;break}return e.a(3,8);case 5:return e.p=5,e.n=6,u(U,a.data.iv,a.data.ciphertext);case 6:i=e.v,n.push(JSON.parse(i)),e.n=8;break;case 7:e.p=7,c=e.v,console.error("Error decrypting credential ".concat(a.id,":"),c);case 8:e.n=4;break;case 9:e.n=11;break;case 10:e.p=10,s=e.v,t.e(s);case 11:return e.p=11,t.f(),e.f(11);case 12:return e.a(2,n);case 13:throw e.p=13,l=e.v,console.error("Error getting all credentials:",l),l;case 14:return e.a(2)}},e,null,[[5,7],[3,10,11,12],[1,13]])}))).apply(this,arguments)}function X(e){return Y.apply(this,arguments)}function Y(){return(Y=G(x().m(function e(r){var n,t;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!N&&U){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,H();case 2:return n=e.v,e.a(2,n.filter(function(e){return e.url&&(e.url===r||r.includes(e.url)||e.url.includes(r))}));case 3:throw e.p=3,t=e.v,console.error("Error searching credentials by URL:",t),t;case 4:return e.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}function Z(){return(Z=G(x().m(function e(r,n){var t,a,c,u,s,l,f,p,d,v,h;return x().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,B(r);case 1:if(e.v){e.n=2;break}return e.a(2,!1);case 2:return e.n=3,H();case 3:return t=e.v,a=window.crypto.getRandomValues(new Uint8Array(16)),e.n=4,o(n,a);case 4:c=e.v,u=M(t),e.p=5,u.s();case 6:if((s=u.n()).done){e.n=9;break}return l=s.value,e.n=7,i(c,JSON.stringify(l));case 7:return f=e.v,e.n=8,g({id:l.id,url:l.url,username:l.username,data:f});case 8:e.n=6;break;case 9:e.n=11;break;case 10:e.p=10,v=e.v,u.e(v);case 11:return e.p=11,u.f(),e.f(11);case 12:return p={id:I,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),version:1},e.n=13,i(c,JSON.stringify(p));case 13:return d=e.v,e.n=14,g({id:I,data:d});case 14:return e.n=15,E({id:C,salt:Array.from(a)});case 15:return U=c,e.a(2,!0);case 16:return e.p=16,h=e.v,console.error("Error changing master password:",h),e.a(2,!1)}},e,null,[[5,10,11,12],[0,16]])}))).apply(this,arguments)}function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function re(e,r,n){return(r=function(e){var r=function(e){if("object"!=ee(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(r)?r:r+""}(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function ne(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,t,o,a){var u=t&&t.prototype instanceof c?t:c,s=Object.create(u.prototype);return te(s,"_invoke",function(n,t,o){var a,c,u,s=0,l=o||[],f=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(r,n){return a=r,c=0,u=e,p.n=n,i}};function d(n,t){for(c=n,u=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],d=p.p,v=a[2];n>3?(o=v===t)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=n<2&&d<a[1])?(c=0,p.v=t,p.n=a[1]):d<v&&(o=n<3||a[0]>t||t>v)&&(a[4]=n,a[5]=t,p.n=v,c=0))}if(o||n>1)return i;throw f=!0,t}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,v),c=l,u=v;(r=c<2?e:u)||!f;){a||(c?c<3?(c>1&&(p.n=-1),d(c,u)):p.n=u:p.v=u);try{if(s=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((r=(f=p.n<0)?u:n.call(t,p))!==i)break}catch(r){a=e,c=1,u=r}finally{s=1}}return{value:r,done:f}}}(n,o,a),!0),s}var i={};function c(){}function u(){}function s(){}r=Object.getPrototypeOf;var l=[][t]?r(r([][t]())):(te(r={},t,function(){return this}),r),f=s.prototype=c.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,te(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,te(f,"constructor",s),te(s,"constructor",u),u.displayName="GeneratorFunction",te(s,o,"GeneratorFunction"),te(f),te(f,o,"Generator"),te(f,t,function(){return this}),te(f,"toString",function(){return"[object Generator]"}),(ne=function(){return{w:a,m:p}})()}function te(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}te=function(e,r,n,t){function a(r,n){te(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},te(e,r,n,t)}function oe(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return ae(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ae(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function ae(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function ie(e,r,n,t,o,a,i){try{var c=e[a](i),u=c.value}catch(e){return void n(e)}c.done?r(u):Promise.resolve(u).then(t,o)}function ce(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function i(e){ie(a,t,o,i,c,"next",e)}function c(e){ie(a,t,o,i,c,"throw",e)}i(void 0)})}}var ue="user-settings",se="auto-lock-alarm",le="inactivity-check-alarm",fe="last-user-activity",pe=null,de=Date.now();function ve(){return(ve=ce(ne().m(function e(){var r;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,P(ue);case 1:if(pe=e.v){e.n=2;break}return pe={id:ue,autoLockEnabled:!0,autoLockTime:5,keyStretchingIterations:1e5,theme:"light",fontSize:14,autofillEnabled:!0,autofillIconEnabled:!0,autofillConfirmation:!0},e.n=2,E(pe);case 2:pe.autoLockEnabled&&be(),Pe(),chrome.runtime.onMessage.addListener(he),chrome.alarms.onAlarm.addListener(we),chrome.tabs.onUpdated.addListener(ke),chrome.action.onClicked.addListener(Oe),Ee(),chrome.commands.onCommand.addListener(je),console.log("Background script initialized"),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Background initialization error:",r);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function he(e,r,n){if(Te(),"getCredentialsForUrl"===e.action)return function(e,r,n){ye.apply(this,arguments)}(e,r,n),!0;if("saveNewCredential"===e.action)return function(e,r,n){me.apply(this,arguments)}(e,r,n),!0;if("isVaultInitialized"===e.action)return function(){return V.apply(this,arguments)}().then(function(e){n({initialized:e})}),!0;if("initializeVault"===e.action)return function(e){return F.apply(this,arguments)}(e.password).then(function(e){n({success:e})}),!0;var t;if("unlockVault"===e.action)return B(e.password,(null===(t=pe)||void 0===t?void 0:t.autoLockTime)||5).then(function(e){e&&Se(!1),n({success:e})}),!0;if("lockVault"===e.action)return z(),Se(!0),n({success:!0}),!0;if("isVaultLocked"===e.action){var o=R();return Se(o),n({locked:o}),!0}return"changeMasterPassword"===e.action?(function(e,r){return Z.apply(this,arguments)}(e.currentPassword,e.newPassword).then(function(e){n({success:e})}),!0):"updateSettings"===e.action?(E(e.settings).then(function(){(pe=e.settings).autoLockEnabled?be():chrome.alarms.clear(se),n({success:!0})}).catch(function(e){console.error("Error saving settings:",e),n({success:!1,error:e.message})}),!0):"generatePassword"===e.action?(n({success:!0}),!0):"fillCredentialById"===e.action?(function(e,r,n){ge.apply(this,arguments)}(e,r,n),!0):void 0}function ye(){return(ye=ce(ne().m(function e(r,n,t){var o,a;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!R()){e.n=1;break}return t({credentials:[]}),e.a(2);case 1:return e.n=2,X(r.url);case 2:o=e.v,t({credentials:o}),e.n=4;break;case 3:e.p=3,a=e.v,console.error("Error getting credentials for URL:",a),t({credentials:[],error:a.message});case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function me(){return(me=ce(ne().m(function e(r,n,t){var o,a;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!R()){e.n=1;break}return chrome.runtime.sendMessage({action:"promptUnlock",pendingCredential:r.credential}),t({success:!1,error:"Vault is locked"}),e.a(2);case 1:return o=new URL(r.credential.url).hostname,e.n=2,chrome.storage.local.get("neverSaveList");case 2:if(!(e.v.neverSaveList||[]).includes(o)){e.n=3;break}return t({success:!1,error:"Site is in never-save list"}),e.a(2);case 3:chrome.notifications.create({type:"basic",iconUrl:"../assets/icon.png",title:"Save Password?",message:"Do you want to save the password for ".concat(r.credential.username," on ").concat(o,"?"),buttons:[{title:"Save"},{title:"Never for this site"}],requireInteraction:!0},function(e){chrome.storage.session.set(re({},"pending_credential_".concat(e),r.credential))}),t({success:!0}),e.n=5;break;case 4:e.p=4,a=e.v,console.error("Error saving new credential:",a),t({success:!1,error:a.message});case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function ge(){return(ge=ce(ne().m(function e(r,n,t){var o,a;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!R()){e.n=1;break}return t({success:!1,error:"Vault is locked"}),e.a(2);case 1:return e.n=2,q(r.id);case 2:if(o=e.v){e.n=3;break}return t({success:!1,error:"Credential not found"}),e.a(2);case 3:chrome.tabs.sendMessage(n.tab.id,{action:"fillCredential",credential:o}),t({success:!0}),e.n=5;break;case 4:e.p=4,a=e.v,console.error("Error filling credential by ID:",a),t({success:!1,error:a.message});case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function be(){chrome.alarms.clear(se),pe&&pe.autoLockEnabled&&pe.autoLockTime>0&&chrome.alarms.create(se,{delayInMinutes:pe.autoLockTime,periodInMinutes:pe.autoLockTime})}function we(e){e.name===se&&(R()||(z(),Se(!0),chrome.runtime.sendMessage({action:"vaultLocked"}))),e.name===le&&function(){Me.apply(this,arguments)}()}function ke(e,r,n){if("complete"===r.status&&n.url){if(n.url.startsWith("chrome://")||n.url.startsWith("edge://")||n.url.startsWith("about:")||n.url.startsWith("moz-extension://"))return;R()||X(n.url).then(function(r){r&&r.length>0&&chrome.tabs.sendMessage(e,{action:"credentialsUpdated",credentials:r}).catch(function(){})}).catch(function(e){console.error("Error finding credentials for tab:",e)})}}function Se(e){e?(chrome.action.setBadgeText({text:"🔒"}),chrome.action.setBadgeBackgroundColor({color:"#e74c3c"})):(chrome.action.setBadgeText({text:"🔓"}),chrome.action.setBadgeBackgroundColor({color:"#2ecc71"}))}function Oe(e){Te()}function Ee(){chrome.contextMenus.create({id:"generate-password",title:"Generate Password",contexts:["editable"]}),chrome.contextMenus.create({id:"fill-credentials",title:"Fill Credentials",contexts:["editable"]}),chrome.contextMenus.onClicked.addListener(function(e,r){"generate-password"===e.menuItemId&&chrome.tabs.sendMessage(r.id,{action:"showPasswordGenerator",target:e.targetElementId}),"fill-credentials"===e.menuItemId&&(R()?chrome.tabs.sendMessage(r.id,{action:"showVaultLockedMessage"}):X(r.url).then(function(n){n&&n.length>0?chrome.tabs.sendMessage(r.id,{action:"showCredentialsMenu",credentials:n,target:e.targetElementId}):chrome.tabs.sendMessage(r.id,{action:"showNoCredentialsMessage"})}))})}function je(e){"toggle-vault-lock"===e&&(R()?chrome.action.openPopup():(z(),Se(!0),chrome.runtime.sendMessage({action:"vaultLocked"}))),"fill-credentials"===e&&chrome.tabs.query({active:!0,currentWindow:!0},function(){var e=ce(ne().m(function e(r){var n,t;return ne().w(function(e){for(;;)switch(e.n){case 0:if(0!==r.length){e.n=1;break}return e.a(2);case 1:if(n=r[0],R()){e.n=3;break}return e.n=2,X(n.url);case 2:(t=e.v)&&t.length>0&&(1===t.length?chrome.tabs.sendMessage(n.id,{action:"fillCredential",credential:t[0]}):chrome.tabs.sendMessage(n.id,{action:"showCredentialsMenu",credentials:t})),e.n=4;break;case 3:chrome.action.openPopup();case 4:return e.a(2)}},e)}));return function(r){return e.apply(this,arguments)}}()),Te()}function Pe(){Te(),chrome.alarms.create(le,{periodInMinutes:1})}function Te(){de=Date.now(),chrome.storage.local.set(re({},fe,de))}function Me(){return(Me=ce(ne().m(function e(){var r,n,t;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(pe&&pe.autoLockEnabled){e.n=1;break}return e.a(2);case 1:if(!R()){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,chrome.storage.local.get(fe);case 3:r=e.v,n=r[fe]||de,(Date.now()-n)/6e4>=pe.autoLockTime&&(z(),Se(!0),chrome.runtime.sendMessage({action:"vaultLocked"})),e.n=5;break;case 4:e.p=4,t=e.v,console.error("Error checking inactivity:",t);case 5:return e.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}chrome.notifications.onButtonClicked.addListener(function(){var e=ce(ne().m(function e(r,n){var t,o,a,i,c,u,s,l,f,p,d,v,h;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.session.get("pending_credential_".concat(r));case 1:if(t=e.v,o=t["pending_credential_".concat(r)]){e.n=2;break}return e.a(2);case 2:if(0!==n){e.n=13;break}return e.n=3,K({url:o.url,name:new URL(o.url).hostname,username:o.username,password:o.password,notes:""});case 3:return e.n=4,chrome.tabs.query({url:o.url+"*"});case 4:a=e.v,i=oe(a),e.p=5,i.s();case 6:if((c=i.n()).done){e.n=9;break}return u=c.value,f=chrome.tabs,p=u.id,e.n=7,X(o.url);case 7:d=e.v,f.sendMessage.call(f,p,{action:"credentialsUpdated",credentials:d}).catch(function(){});case 8:e.n=6;break;case 9:e.n=11;break;case 10:e.p=10,v=e.v,i.e(v);case 11:return e.p=11,i.f(),e.f(11);case 12:e.n=15;break;case 13:if(1!==n){e.n=15;break}return e.n=14,chrome.storage.local.get("neverSaveList");case 14:return s=e.v,(l=s.neverSaveList||[]).push(new URL(o.url).hostname),e.n=15,chrome.storage.local.set({neverSaveList:l});case 15:return e.n=16,chrome.storage.session.remove("pending_credential_".concat(r));case 16:e.n=18;break;case 17:e.p=17,h=e.v,console.error("Error handling notification click:",h);case 18:return e.a(2)}},e,null,[[5,10,11,12],[0,17]])}));return function(r,n){return e.apply(this,arguments)}}()),function(){ve.apply(this,arguments)}()})();