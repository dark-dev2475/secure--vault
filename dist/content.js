/*! For license information please see content.js.LICENSE.txt */
(()=>{"use strict";function e(){var t,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function u(e,o,i,a){var u=o&&o.prototype instanceof s?o:s,l=Object.create(u.prototype);return n(l,"_invoke",function(e,n,o){var i,a,u,s=0,l=o||[],d=!1,f={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,n){return i=e,a=0,u=t,f.n=n,c}};function p(e,n){for(a=e,u=n,r=0;!d&&s&&!o&&r<l.length;r++){var o,i=l[r],p=f.p,v=i[2];e>3?(o=v===n)&&(u=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=e<2&&p<i[1])?(a=0,f.v=n,f.n=i[1]):p<v&&(o=e<3||i[0]>n||n>v)&&(i[4]=e,i[5]=n,f.n=v,a=0))}if(o||e>1)return c;throw d=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),a=l,u=v;(r=a<2?t:u)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,u)):f.n=u:f.v=u);try{if(s=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((r=(d=f.n<0)?u:e.call(n,f))!==c)break}catch(e){i=t,a=1,u=e}finally{s=1}}return{value:r,done:d}}}(e,i,a),!0),l}var c={};function s(){}function l(){}function d(){}r=Object.getPrototypeOf;var f=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),p=d.prototype=s.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,n(p,"constructor",d),n(d,"constructor",l),l.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(p),n(p,a,"Generator"),n(p,i,function(){return this}),n(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:u,m:v}})()}function n(e,t,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}n=function(e,t,r,o){function a(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},n(e,t,r,o)}function t(e,n,t,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void t(e)}u.done?n(c):Promise.resolve(c).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(o,i){var a=e.apply(n,r);function u(e){t(a,o,i,u,c,"next",e)}function c(e){t(a,o,i,u,c,"throw",e)}u(void 0)})}}var o="vault",i="settings";function a(){return u.apply(this,arguments)}function u(){return(u=r(e().m(function n(){return e().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){var t=indexedDB.open("secure-shelf-db",1);t.onerror=function(e){n("Error opening database: "+e.target.error)},t.onsuccess=function(n){e(n.target.result)},t.onupgradeneeded=function(e){var n=e.target.result;n.objectStoreNames.contains(o)||n.createObjectStore(o,{keyPath:"id"}),n.objectStoreNames.contains(i)||n.createObjectStore(i,{keyPath:"id"})}}))},n)}))).apply(this,arguments)}function c(e){return s.apply(this,arguments)}function s(){return(s=r(e().m(function n(t){var r;return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,a();case 1:return r=e.v,e.a(2,new Promise(function(e,n){var o=r.transaction([i],"readonly"),a=o.objectStore(i).get(t);a.onsuccess=function(n){e(n.target.result)},a.onerror=function(e){n("Error retrieving settings: "+e.target.error)},o.oncomplete=function(){r.close()}}))}},n)}))).apply(this,arguments)}function l(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function d(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function i(t,r,o,i){var c=r&&r.prototype instanceof u?r:u,s=Object.create(c.prototype);return f(s,"_invoke",function(t,r,o){var i,u,c,s=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,t){return i=n,u=0,c=e,f.n=t,a}};function p(t,r){for(u=t,c=r,n=0;!d&&s&&!o&&n<l.length;n++){var o,i=l[n],p=f.p,v=i[2];t>3?(o=v===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(u=0,f.v=r,f.n=i[1]):p<v&&(o=t<3||i[0]>r||r>v)&&(i[4]=t,i[5]=r,f.n=v,u=0))}if(o||t>1)return a;throw d=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,v),u=l,c=v;(n=u<2?e:c)||!d;){i||(u?u<3?(u>1&&(f.n=-1),p(u,c)):f.n=c:f.v=c);try{if(s=2,i){if(u||(o="next"),n=i[o]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,u<2&&(u=0)}else 1===u&&(n=i.return)&&n.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((n=(d=f.n<0)?c:t.call(r,f))!==a)break}catch(n){i=e,u=1,c=n}finally{s=1}}return{value:n,done:d}}}(t,o,i),!0),s}var a={};function u(){}function c(){}function s(){}n=Object.getPrototypeOf;var l=[][r]?n(n([][r]())):(f(n={},r,function(){return this}),n),p=s.prototype=u.prototype=Object.create(l);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,f(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=s,f(p,"constructor",s),f(s,"constructor",c),c.displayName="GeneratorFunction",f(s,o,"GeneratorFunction"),f(p),f(p,o,"Generator"),f(p,r,function(){return this}),f(p,"toString",function(){return"[object Generator]"}),(d=function(){return{w:i,m:v}})()}function f(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,n,t,r){function i(n,t){f(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(i("next",0),i("throw",1),i("return",2))},f(e,n,t,r)}function p(e,n,t,r,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void t(e)}u.done?n(c):Promise.resolve(c).then(r,o)}var v,m,h="data-secure-shelf-observed",b=null,y=null,w=null;function g(){chrome.runtime.sendMessage({action:"getCredentialsForUrl",url:window.location.href},function(e){e&&e.credentials&&(w=e.credentials,F())})}function E(){y&&y.disconnect(),(y=new MutationObserver(function(e){var n,t=!1,r=function(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,n){if(e){if("string"==typeof e)return l(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(u)throw i}}}}(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;if("childList"===o.type&&o.addedNodes.length){t=!0;break}}}catch(e){r.e(e)}finally{r.f()}t&&F()})).observe(document.body,{childList:!0,subtree:!0})}function F(){document.querySelectorAll("form:not(["+h+"])").forEach(function(e){e.setAttribute(h,"true");var n=x(e);(n.usernameField||n.passwordField)&&function(e,n){w&&0!==w.length&&(b.autofillIconEnabled&&(n.usernameField&&O(n.usernameField),n.passwordField&&O(n.passwordField)),e.addEventListener("submit",function(){if(n.usernameField&&n.passwordField&&n.usernameField.value&&n.passwordField.value){var e={url:window.location.origin,username:n.usernameField.value,password:n.passwordField.value};w.some(function(n){return n.username===e.username&&n.password===e.password})||chrome.runtime.sendMessage({action:"saveNewCredential",credential:e})}}))}(e,n)});var e,n=S();n.length>0&&(e=n,w&&0!==w.length&&e.forEach(function(e){b.autofillIconEnabled&&(e.usernameField&&O(e.usernameField),e.passwordField&&O(e.passwordField))}))}function x(e){var n={usernameField:null,passwordField:null},t=e.querySelectorAll('input[type="password"]');if(t.length>0){n.passwordField=t[0];var r=Array.from(e.querySelectorAll("input")),o=r.indexOf(n.passwordField);if(o>0)for(var i=0;i<o;i++){var a=r[i],u=a.type.toLowerCase();if("hidden"!==u&&"submit"!==u&&"button"!==u&&"checkbox"!==u&&"radio"!==u){var c=(a.name||"").toLowerCase(),s=(a.id||"").toLowerCase(),l=(a.placeholder||"").toLowerCase(),d=(a.autocomplete||"").toLowerCase();if(c.includes("user")||c.includes("email")||c.includes("login")||s.includes("user")||s.includes("email")||s.includes("login")||l.includes("user")||l.includes("email")||l.includes("login")||"username"===d||"email"===d){n.usernameField=a;break}i===o-1&&(n.usernameField=a)}}}return n}function S(){var e=[];return document.querySelectorAll('input[type="password"]').forEach(function(n){for(var t=n.parentElement,r=!1;t&&t!==document.body;){if("FORM"===t.tagName){r=!0;break}t=t.parentElement}if(!r){var o=function(e){for(var n=e.previousElementSibling;n;){if("INPUT"===n.tagName&&"password"!==n.type&&"hidden"!==n.type&&"submit"!==n.type&&"button"!==n.type)return n;n=n.previousElementSibling}if(e.parentElement)for(var t=Array.from(e.parentElement.children),r=t.indexOf(e),o=0;o<r;o++){var i=t[o];if("INPUT"===i.tagName&&"password"!==i.type&&"hidden"!==i.type&&"submit"!==i.type&&"button"!==i.type)return i}return null}(n);e.push({passwordField:n,usernameField:o})}}),e}function O(e){if(!e.parentElement.querySelector(".secure-shelf-autofill-icon")){var n=document.createElement("div");n.className="secure-shelf-autofill-icon",n.style.cssText="\n    position: absolute;\n    right: 5px;\n    top: 50%;\n    transform: translateY(-50%);\n    width: ".concat(20,"px;\n    height: ").concat(20,"px;\n    background-color: rgba(52, 152, 219, 0.8);\n    border-radius: 50%;\n    cursor: pointer;\n    z-index: 9999;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    color: white;\n    user-select: none;\n  "),n.textContent="🔑","static"===getComputedStyle(e.parentElement).position&&(e.parentElement.style.position="relative"),n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var r=document.querySelector(".secure-shelf-credentials-dropdown");r&&r.remove(),function(e,n){var t=document.createElement("div");t.className="secure-shelf-credentials-dropdown",t.style.cssText="\n    position: absolute;\n    top: ".concat(e.offsetHeight+5,"px;\n    right: 0;\n    width: 250px;\n    max-height: 200px;\n    overflow-y: auto;\n    background-color: white;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    z-index: 10000;\n    padding: 5px 0;\n  "),"static"===getComputedStyle(e.parentElement).position&&(e.parentElement.style.position="relative"),w.forEach(function(e){var n=document.createElement("div");n.style.cssText="\n      padding: 8px 12px;\n      cursor: pointer;\n      transition: background-color 0.2s;\n      font-size: 14px;\n    ";var r=document.createElement("div");r.textContent=e.username,r.style.fontWeight="bold";var o=document.createElement("div");o.textContent=e.url,o.style.cssText="\n      font-size: 12px;\n      color: #666;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    ",n.appendChild(r),n.appendChild(o),n.addEventListener("mouseover",function(){n.style.backgroundColor="#f5f5f5"}),n.addEventListener("mouseout",function(){n.style.backgroundColor="white"}),n.addEventListener("click",function(){C(e),t.remove()}),t.appendChild(n)}),e.parentElement.appendChild(t),document.addEventListener("click",function e(r){t.contains(r.target)||r.target===n||(t.remove(),document.removeEventListener("click",e))})}(e,n)}),e.parentElement.appendChild(n),e.style.paddingRight="".concat(30,"px")}}function C(e){b.autofillConfirmation&&!confirm("Fill login details for ".concat(e.username,"?"))||(document.querySelectorAll("form").forEach(function(n){var t=x(n);t.usernameField&&(t.usernameField.value=e.username,t.usernameField.dispatchEvent(new Event("input",{bubbles:!0})),t.usernameField.dispatchEvent(new Event("change",{bubbles:!0}))),t.passwordField&&(t.passwordField.value=e.password,t.passwordField.dispatchEvent(new Event("input",{bubbles:!0})),t.passwordField.dispatchEvent(new Event("change",{bubbles:!0})))}),S().forEach(function(n){n.usernameField&&(n.usernameField.value=e.username,n.usernameField.dispatchEvent(new Event("input",{bubbles:!0})),n.usernameField.dispatchEvent(new Event("change",{bubbles:!0}))),n.passwordField&&(n.passwordField.value=e.password,n.passwordField.dispatchEvent(new Event("input",{bubbles:!0})),n.passwordField.dispatchEvent(new Event("change",{bubbles:!0})))}))}function j(){chrome.runtime.onMessage.addListener(function(e,n,t){var r,o;return"requestFillCredential"===e.action?(r=window.location.href,chrome.runtime.sendMessage({action:"getCredentialsForUrl",url:r},function(e){e&&e.credentials&&e.credentials.length>0?displayCredentialOptions(e.credentials):showNotification("No saved credentials found for this site")}),t({success:!0})):"requestGeneratePassword"===e.action?(chrome.runtime.sendMessage({action:"openPasswordGenerator",targetField:(o=document.activeElement,!o||"INPUT"!==o.tagName&&"TEXTAREA"!==o.tagName?null:{id:o.id,name:o.name,type:o.type,form:o.form?o.form.id:null})}),t({success:!0})):"credentialsUpdated"===e.action?(w=e.credentials,F(),t({success:!0})):"fillCredential"===e.action&&(C(e.credential),t({success:!0})),!0})}(v=d().m(function e(){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,c("user-settings");case 1:if((b=e.v)||(b={autofillEnabled:!0,autofillIconEnabled:!0,autofillConfirmation:!0}),j(),b.autofillEnabled){e.n=2;break}return e.a(2);case 2:g(),E(),F(),e.n=4;break;case 3:e.p=3,n=e.v,console.error("Content script initialization error:",n);case 4:return e.a(2)}},e,null,[[0,3]])}),m=function(){var e=this,n=arguments;return new Promise(function(t,r){var o=v.apply(e,n);function i(e){p(o,t,r,i,a,"next",e)}function a(e){p(o,t,r,i,a,"throw",e)}i(void 0)})},function(){return m.apply(this,arguments)})()})();