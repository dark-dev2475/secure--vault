/*! For license information please see popup.js.LICENSE.txt */
(()=>{"use strict";function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(e,o,a,c){var i=o&&o.prototype instanceof s?o:s,l=Object.create(i.prototype);return t(l,"_invoke",function(e,t,o){var a,c,i,s=0,l=o||[],f=!1,d={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return a=e,c=0,i=n,d.n=t,u}};function p(e,t){for(c=e,i=t,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],p=d.p,v=a[2];e>3?(o=v===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=p&&((o=e<2&&p<a[1])?(c=0,d.v=t,d.n=a[1]):p<v&&(o=e<3||a[0]>t||t>v)&&(a[4]=e,a[5]=t,d.n=v,c=0))}if(o||e>1)return u;throw f=!0,t}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),c=l,i=v;(r=c<2?n:i)||!f;){a||(c?c<3?(c>1&&(d.n=-1),p(c,i)):d.n=i:d.v=i);try{if(s=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((r=(f=d.n<0)?i:e.call(t,d))!==u)break}catch(e){a=n,c=1,i=e}finally{s=1}}return{value:r,done:f}}}(e,a,c),!0),l}var u={};function s(){}function l(){}function f(){}r=Object.getPrototypeOf;var d=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),p=f.prototype=s.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,c,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,t(p,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,c,"GeneratorFunction"),t(p),t(p,c,"Generator"),t(p,a,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:v}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var c=e.apply(t,r);function i(e){n(c,o,a,i,u,"next",e)}function u(e){n(c,o,a,i,u,"throw",e)}i(void 0)})}}function o(e,t){return a.apply(this,arguments)}function a(){return a=r(e().m(function t(n,r){var o,a,c,i=arguments;return e().w(function(e){for(;;)switch(e.n){case 0:return o=i.length>2&&void 0!==i[2]?i[2]:1e5,a=new TextEncoder,e.n=1,window.crypto.subtle.importKey("raw",a.encode(n),{name:"PBKDF2"},!1,["deriveKey"]);case 1:return c=e.v,e.a(2,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:o,hash:"SHA-256"},c,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))}},t)})),a.apply(this,arguments)}function c(e,t){return i.apply(this,arguments)}function i(){return(i=r(e().m(function t(n,r){var o,a,c;return e().w(function(e){for(;;)switch(e.n){case 0:return o=new TextEncoder,a=window.crypto.getRandomValues(new Uint8Array(12)),e.n=1,window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},n,o.encode(r));case 1:return c=e.v,e.a(2,{iv:Array.from(a),ciphertext:Array.from(new Uint8Array(c))})}},t)}))).apply(this,arguments)}function u(e,t,n){return s.apply(this,arguments)}function s(){return(s=r(e().m(function t(n,r,o){var a,c,i,u;return e().w(function(e){for(;;)switch(e.n){case 0:return a=new TextDecoder,c=new Uint8Array(o),i=new Uint8Array(r),e.n=1,window.crypto.subtle.decrypt({name:"AES-GCM",iv:i},n,c);case 1:return u=e.v,e.a(2,a.decode(u))}},t)}))).apply(this,arguments)}function l(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof i?r:i,s=Object.create(u.prototype);return f(s,"_invoke",function(n,r,o){var a,i,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,u=e,d.n=n,c}};function p(n,r){for(i=n,u=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,v=a[2];n>3?(o=v===r)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,d.n=v,i=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,u=v;(t=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,u)):d.n=u:d.v=u);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==c)break}catch(t){a=e,i=1,u=t}finally{s=1}}return{value:t,done:f}}}(n,o,a),!0),s}var c={};function i(){}function u(){}function s(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(f(t={},r,function(){return this}),t),p=s.prototype=i.prototype=Object.create(d);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,f(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=s,f(p,"constructor",s),f(s,"constructor",u),u.displayName="GeneratorFunction",f(s,o,"GeneratorFunction"),f(p),f(p,o,"Generator"),f(p,r,function(){return this}),f(p,"toString",function(){return"[object Generator]"}),(l=function(){return{w:a,m:v}})()}function f(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,t,n,r){function a(t,n){f(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},f(e,t,n,r)}function d(e,t,n,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,o)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){d(a,r,o,c,i,"next",e)}function i(e){d(a,r,o,c,i,"throw",e)}c(void 0)})}}var v="vault",m="settings";function y(){return h.apply(this,arguments)}function h(){return(h=p(l().m(function e(){return l().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,t){var n=indexedDB.open("secure-shelf-db",1);n.onerror=function(e){t("Error opening database: "+e.target.error)},n.onsuccess=function(t){e(t.target.result)},n.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains(v)||t.createObjectStore(v,{keyPath:"id"}),t.objectStoreNames.contains(m)||t.createObjectStore(m,{keyPath:"id"})}}))},e)}))).apply(this,arguments)}function b(e){return g.apply(this,arguments)}function g(){return(g=p(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,r){var o=n.transaction([v],"readwrite"),a=o.objectStore(v).put(t);a.onsuccess=function(){e()},a.onerror=function(e){r("Error saving to vault: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function w(e){return E.apply(this,arguments)}function E(){return(E=p(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,r){var o=n.transaction([v],"readonly"),a=o.objectStore(v).get(t);a.onsuccess=function(t){e(t.target.result)},a.onerror=function(e){r("Error retrieving from vault: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function k(){return O.apply(this,arguments)}function O(){return(O=p(l().m(function e(){var t;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return t=e.v,e.a(2,new Promise(function(e,n){var r=t.transaction([v],"readonly"),o=r.objectStore(v).getAll();o.onsuccess=function(t){e(t.target.result)},o.onerror=function(e){n("Error retrieving all from vault: "+e.target.error)},r.oncomplete=function(){t.close()}}))}},e)}))).apply(this,arguments)}function S(e){return j.apply(this,arguments)}function j(){return(j=p(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,r){var o=n.transaction([v],"readwrite"),a=o.objectStore(v).delete(t);a.onsuccess=function(){e()},a.onerror=function(e){r("Error removing from vault: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function P(e){return I.apply(this,arguments)}function I(){return(I=p(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,r){var o=n.transaction([m],"readwrite"),a=o.objectStore(m).put(t);a.onsuccess=function(){e()},a.onerror=function(e){r("Error saving settings: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function x(e){return L.apply(this,arguments)}function L(){return(L=p(l().m(function e(t){var n;return l().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,y();case 1:return n=e.v,e.a(2,new Promise(function(e,r){var o=n.transaction([m],"readonly"),a=o.objectStore(m).get(t);a.onsuccess=function(t){e(t.target.result)},a.onerror=function(e){r("Error retrieving settings: "+e.target.error)},o.oncomplete=function(){n.close()}}))}},e)}))).apply(this,arguments)}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function C(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t,n){return(t=function(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function D(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof i?r:i,s=Object.create(u.prototype);return N(s,"_invoke",function(n,r,o){var a,i,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,u=e,d.n=n,c}};function p(n,r){for(i=n,u=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,v=a[2];n>3?(o=v===r)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,d.n=v,i=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,u=v;(t=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,u)):d.n=u:d.v=u);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==c)break}catch(t){a=e,i=1,u=t}finally{s=1}}return{value:t,done:f}}}(n,o,a),!0),s}var c={};function i(){}function u(){}function s(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(N(t={},r,function(){return this}),t),f=s.prototype=i.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,N(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,N(f,"constructor",s),N(s,"constructor",u),u.displayName="GeneratorFunction",N(s,o,"GeneratorFunction"),N(f),N(f,o,"Generator"),N(f,r,function(){return this}),N(f,"toString",function(){return"[object Generator]"}),(D=function(){return{w:a,m:d}})()}function N(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}N=function(e,t,n,r){function a(t,n){N(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},N(e,t,n,r)}function F(e,t,n,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,o)}function M(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){F(a,r,o,c,i,"next",e)}function i(e){F(a,r,o,c,i,"throw",e)}c(void 0)})}}var U,V="vault-metadata",R="vault-salt",J=null,q=!0,K="session-master-key";function z(e){return $.apply(this,arguments)}function $(){return($=M(D().m(function e(t){var n,r,a,i;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=window.crypto.getRandomValues(new Uint8Array(16)),e.n=1,P({id:R,salt:Array.from(n)});case 1:return r={id:V,created:(new Date).toISOString(),lastModified:(new Date).toISOString(),version:1},e.n=2,o(t,n);case 2:return J=e.v,e.n=3,c(J,JSON.stringify(r));case 3:return a=e.v,e.n=4,b({id:V,data:a});case 4:return q=!1,e.a(2,!0);case 5:return e.p=5,i=e.v,console.error("Error initializing vault:",i),e.a(2,!1)}},e,null,[[0,5]])}))).apply(this,arguments)}function H(){return Z.apply(this,arguments)}function Z(){return(Z=M(D().m(function e(){var t;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,w(V);case 1:return t=e.v,e.a(2,!!t);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])}))).apply(this,arguments)}function W(e){return Q.apply(this,arguments)}function Q(){return Q=M(D().m(function e(t){var n,r,a,i,s,l,f,d,p,v,m,y,h,g,E=arguments;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=E.length>1&&void 0!==E[1]?E[1]:5,e.p=1,e.n=2,x(R);case 2:if(r=e.v){e.n=3;break}return e.a(2,!1);case 3:return a=new Uint8Array(r.salt),e.n=4,o(t,a);case 4:return J=e.v,e.n=5,w(V);case 5:if(i=e.v){e.n=6;break}return e.a(2,!1);case 6:return e.p=6,e.n=7,u(J,i.data.iv,i.data.ciphertext);case 7:return s=e.v,JSON.parse(s),(l=JSON.parse(s)).lastAccessed=(new Date).toISOString(),e.n=8,c(J,JSON.stringify(l));case 8:return f=e.v,e.n=9,b({id:V,data:f});case 9:return q=!1,e.p=10,e.n=11,window.crypto.subtle.exportKey("raw",J);case 11:return d=e.v,p=Array.from(new Uint8Array(d)),e.n=12,chrome.storage.session.set(_({},K,p));case 12:e.n=14;break;case 13:e.p=13,y=e.v,console.warn("Could not persist session key:",y);case 14:return v=n,e.p=15,e.n=16,x("user-settings");case 16:(m=e.v)&&(!1===m.autoLockEnabled?v=0:m.autoLockTime>0&&(v=m.autoLockTime)),console.log("Using auto-lock timeout: ".concat(v," minutes")),e.n=18;break;case 17:e.p=17,h=e.v,console.error("Error getting user settings:",h);case 18:return e.a(2,!0);case 19:return e.p=19,e.v,e.a(2,!1);case 20:return e.p=20,g=e.v,console.error("Error unlocking vault:",g),e.a(2,!1);case 21:return e.a(2)}},e,null,[[15,17],[10,13],[6,19],[1,20]])})),Q.apply(this,arguments)}function X(){J=null,q=!0,chrome.runtime.sendMessage({action:"lockVault"});try{chrome.storage.session.remove(K)}catch(e){}}function Y(e){return ee.apply(this,arguments)}function ee(){return(ee=M(D().m(function e(t){var n,r;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!q&&J){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,t.id||(t.id="cred-"+Date.now()+"-"+Math.floor(1e3*Math.random())),t.createdAt=(new Date).toISOString(),t.updatedAt=(new Date).toISOString(),e.n=2,c(J,JSON.stringify(t));case 2:return n=e.v,e.n=3,b({id:t.id,url:t.url,username:t.username,data:n});case 3:return e.a(2,t.id);case 4:throw e.p=4,r=e.v,console.error("Error adding credential:",r),r;case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=M(D().m(function e(t,n){var r,o,a,i,s,l;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!q&&J){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,w(t);case 2:if(r=e.v){e.n=3;break}return e.a(2,!1);case 3:return e.n=4,u(J,r.data.iv,r.data.ciphertext);case 4:return o=e.v,a=JSON.parse(o),i=G(G(G({},a),n),{},{updatedAt:(new Date).toISOString()}),e.n=5,c(J,JSON.stringify(i));case 5:return s=e.v,e.n=6,b({id:t,url:i.url,username:i.username,data:s});case 6:return e.a(2,!0);case 7:throw e.p=7,l=e.v,console.error("Error updating credential:",l),l;case 8:return e.a(2)}},e,null,[[1,7]])}))).apply(this,arguments)}function re(e){return oe.apply(this,arguments)}function oe(){return(oe=M(D().m(function e(t){var n,r,o;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!q&&J){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,w(t);case 2:if(n=e.v){e.n=3;break}return e.a(2,null);case 3:return e.n=4,u(J,n.data.iv,n.data.ciphertext);case 4:return r=e.v,e.a(2,JSON.parse(r));case 5:throw e.p=5,o=e.v,console.error("Error getting credential:",o),o;case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}function ae(){return ce.apply(this,arguments)}function ce(){return(ce=M(D().m(function e(){var t,n,r,o,a,c,i,s,l;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!q&&J){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,k();case 2:t=e.v,n=[],r=C(t),e.p=3,r.s();case 4:if((o=r.n()).done){e.n=9;break}if((a=o.value).id!==V){e.n=5;break}return e.a(3,8);case 5:return e.p=5,e.n=6,u(J,a.data.iv,a.data.ciphertext);case 6:c=e.v,n.push(JSON.parse(c)),e.n=8;break;case 7:e.p=7,i=e.v,console.error("Error decrypting credential ".concat(a.id,":"),i);case 8:e.n=4;break;case 9:e.n=11;break;case 10:e.p=10,s=e.v,r.e(s);case 11:return e.p=11,r.f(),e.f(11);case 12:return e.a(2,n);case 13:throw e.p=13,l=e.v,console.error("Error getting all credentials:",l),l;case 14:return e.a(2)}},e,null,[[5,7],[3,10,11,12],[1,13]])}))).apply(this,arguments)}function ie(e){return ue.apply(this,arguments)}function ue(){return(ue=M(D().m(function e(t){var n;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!q&&J){e.n=1;break}throw new Error("Vault is locked");case 1:return e.p=1,e.n=2,S(t);case 2:return e.a(2,!0);case 3:return e.p=3,n=e.v,console.error("Error deleting credential:",n),e.a(2,!1)}},e,null,[[1,3]])}))).apply(this,arguments)}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function le(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return fe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){i=!0,a=e},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach(function(t){ve(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ve(e,t,n){return(t=function(e){var t=function(e){if("object"!=se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==se(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function me(e,t,n,r){var o=new Uint32Array(2*e);window.crypto.getRandomValues(o);for(var a="",c="",i=new Set,u=0,s=0;s<e;s++){var l=void 0,f=0;do{var d=o[u++];if(u>=o.length&&(window.crypto.getRandomValues(o),u=0),l=t[d%t.length],f++,!(n&&l===c||r&&i.has(l))&&f>=10)break}while(n&&l===c||r&&i.has(l));a+=l,c=l,i.add(l)}return a}function ye(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof i?r:i,s=Object.create(u.prototype);return be(s,"_invoke",function(n,r,o){var a,i,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,u=e,d.n=n,c}};function p(n,r){for(i=n,u=r,t=0;!f&&s&&!o&&t<l.length;t++){var o,a=l[t],p=d.p,v=a[2];n>3?(o=v===r)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<v&&(o=n<3||a[0]>r||r>v)&&(a[4]=n,a[5]=r,d.n=v,i=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,u=v;(t=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,u)):d.n=u:d.v=u);try{if(s=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=d.n<0)?u:n.call(r,d))!==c)break}catch(t){a=e,i=1,u=t}finally{s=1}}return{value:t,done:f}}}(n,o,a),!0),s}var c={};function i(){}function u(){}function s(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(be(t={},r,function(){return this}),t),f=s.prototype=i.prototype=Object.create(l);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,be(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,be(f,"constructor",s),be(s,"constructor",u),u.displayName="GeneratorFunction",be(s,o,"GeneratorFunction"),be(f),be(f,o,"Generator"),be(f,r,function(){return this}),be(f,"toString",function(){return"[object Generator]"}),(he=function(){return{w:a,m:d}})()}function be(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}be=function(e,t,n,r){function a(t,n){be(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},be(e,t,n,r)}function ge(e,t,n,r,o,a,c){try{var i=e[a](c),u=i.value}catch(e){return void n(e)}i.done?t(u):Promise.resolve(u).then(r,o)}function we(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){ge(a,r,o,c,i,"next",e)}function i(e){ge(a,r,o,c,i,"throw",e)}c(void 0)})}}(U=M(D().m(function e(){var t,n,r;return D().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.storage.session.get(K);case 1:if(t=e.v,!((n=t&&t[K])&&Array.isArray(n)&&n.length>0)){e.n=3;break}return r=new Uint8Array(n).buffer,e.n=2,window.crypto.subtle.importKey("raw",r,{name:"AES-GCM"},!1,["encrypt","decrypt"]);case 2:J=e.v,q=!1;case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[0,4]])})),function(){return U.apply(this,arguments)})();var Ee={auth:document.getElementById("auth-screen"),dashboard:document.getElementById("dashboard-screen"),detail:document.getElementById("detail-screen"),form:document.getElementById("credential-form-screen"),passwordGenerator:document.getElementById("generate-password-screen")},ke=document.getElementById("login-tab"),Oe=document.getElementById("setup-tab"),Se=document.getElementById("login-form"),je=document.getElementById("setup-form"),Pe=document.getElementById("master-password"),Ie=document.getElementById("new-master-password"),xe=document.getElementById("confirm-master-password"),Le=document.getElementById("unlock-button"),Be=document.getElementById("setup-button"),Ce=document.getElementById("login-error"),Ae=document.getElementById("setup-error"),Te=document.getElementById("credentials-list"),Ge=document.getElementById("search-input"),_e=document.getElementById("add-credential-button"),De=document.getElementById("options-button"),Ne=document.getElementById("lock-button"),Fe=document.getElementById("empty-state"),Me=document.getElementById("back-to-list-button"),Ue=document.getElementById("detail-url"),Ve=document.getElementById("username-value"),Re=document.getElementById("password-value"),Je=document.getElementById("detail-notes"),qe=document.getElementById("copy-username"),Ke=document.getElementById("copy-password"),ze=document.getElementById("show-password"),$e=document.getElementById("edit-credential-button"),He=document.getElementById("delete-credential-button"),Ze=document.getElementById("form-title"),We=document.getElementById("cancel-form-button"),Qe=document.getElementById("credential-url"),Xe=document.getElementById("credential-name"),Ye=document.getElementById("credential-username"),et=document.getElementById("credential-password"),tt=document.getElementById("credential-notes"),nt=document.getElementById("generate-password"),rt=document.getElementById("toggle-password"),ot=document.getElementById("save-credential-button"),at=document.getElementById("form-error"),ct=document.getElementById("close-generator-button"),it=document.getElementById("password-length"),ut=document.getElementById("length-value"),st=document.getElementById("include-uppercase"),lt=document.getElementById("include-lowercase"),ft=document.getElementById("include-numbers"),dt=document.getElementById("include-symbols"),pt=document.getElementById("generated-password"),vt=document.getElementById("copy-generated"),mt=document.getElementById("regenerate-button"),yt=document.getElementById("use-password-button"),ht=[],bt=null,gt=!1;function wt(){return Et.apply(this,arguments)}function Et(){return(Et=we(he().m(function e(){var t;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,It(Ee.dashboard),e.n=1,kt();case 1:e.n=3;break;case 2:e.p=2,t=e.v,console.error("Dashboard loading error:",t);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function kt(){return Ot.apply(this,arguments)}function Ot(){return(Ot=we(he().m(function e(){var t;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,ae();case 1:for(ht=e.v;Te.firstChild;)Te.removeChild(Te.firstChild);if(0!==ht.length){e.n=2;break}return Te.appendChild(Fe),e.a(2);case 2:Fe.remove(),ht.forEach(function(e){var t=document.createElement("div");t.className="credential-item",t.dataset.id=e.id;var n=document.createElement("div");n.className="title",n.textContent=e.name||e.url;var r=document.createElement("div");r.className="username",r.textContent=e.username||"",t.appendChild(n),t.appendChild(r),t.addEventListener("click",function(){St(e.id)}),Te.appendChild(t)}),e.n=4;break;case 3:e.p=3,t=e.v,console.error("Credentials loading error:",t);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function St(e){return jt.apply(this,arguments)}function jt(){return(jt=we(he().m(function e(t){var n,r;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,bt=t,e.n=1,re(t);case 1:if(n=e.v){e.n=2;break}return e.a(2);case 2:Ue.textContent=n.url||"",Ve.textContent=n.username||"",Re.textContent="••••••••",Re.dataset.password=n.password||"",Je.textContent=n.notes||"",It(Ee.detail),e.n=4;break;case 3:e.p=3,r=e.v,console.error("Detail view error:",r);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Pt(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=pe(pe({},{length:16,uppercase:!0,lowercase:!0,numbers:!0,symbols:!0,excludeAmbiguous:!1,excludeSimilar:!1,required:"",excluded:"",noConsecutive:!1,noRepeats:!1}),e);t.uppercase||t.lowercase||t.numbers||t.symbols||(t.lowercase=!0);var n="";if(t.uppercase&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),t.lowercase&&(n+="abcdefghijklmnopqrstuvwxyz"),t.numbers&&(n+="0123456789"),t.symbols&&(n+="!@#$%^&*()-_=+[]{}|;:,.<>?/"),t.excluded){var r,o=le(t.excluded);try{for(o.s();!(r=o.n()).done;){var a=r.value;n=n.replace(new RegExp(ye(a),"g"),"")}}catch(e){o.e(e)}finally{o.f()}}if(t.excludeAmbiguous){var c,i=le("1lI0O{}[]()/'\"`~,;:.<>");try{for(i.s();!(c=i.n()).done;){var u=c.value;n=n.replace(new RegExp(ye(u),"g"),"")}}catch(e){i.e(e)}finally{i.f()}}if(t.excludeSimilar){var s,l=le("il1Lo0O");try{for(l.s();!(s=l.n()).done;){var f=s.value;n=n.replace(new RegExp(ye(f),"g"),"")}}catch(e){l.e(e)}finally{l.f()}}if(!n)throw new Error("No characters available after applying exclusions");for(var d="",p=0;p<100;){if(p++,d=me(t.length,n,t.noConsecutive,t.noRepeats),t.required){var v,m=!0,y=le(t.required);try{for(y.s();!(v=y.n()).done;){var h=v.value;if(!d.includes(h)){m=!1;break}}}catch(e){y.e(e)}finally{y.f()}if(!m)continue}var b=!0;if(t.uppercase&&!/[A-Z]/.test(d)&&(b=!1),t.lowercase&&!/[a-z]/.test(d)&&(b=!1),t.numbers&&!/[0-9]/.test(d)&&(b=!1),t.symbols&&!/[^A-Za-z0-9]/.test(d)&&(b=!1),b)break}return p>=100?function(e){var t="";e.uppercase&&(t+="ABCDEFGHJKLMNPQRSTUVWXYZ"),e.lowercase&&(t+="abcdefghijkmnopqrstuvwxyz"),e.numbers&&(t+="23456789"),e.symbols&&(t+="!@#$%^&*()-_=+"),t||(t="abcdefghijkmnopqrstuvwxyz23456789");var n=new Uint32Array(e.length);window.crypto.getRandomValues(n);for(var r="",o=0;o<e.length;o++)r+=t[n[o]%t.length];return r}(t):d}({length:parseInt(it.value),uppercase:st.checked,lowercase:lt.checked,numbers:ft.checked,symbols:dt.checked});pt.value=e}function It(e){Object.values(Ee).forEach(function(e){e.classList.remove("active")}),e.classList.add("active")}function xt(e,t){e.textContent=t,e.classList.remove("hidden")}function Lt(e){navigator.clipboard.writeText(e).catch(function(e){console.error("Could not copy text: ",e)})}function Bt(e){chrome.tabs?chrome.tabs.query({active:!0,currentWindow:!0},function(t){e(t[0])}):e(null)}document.addEventListener("DOMContentLoaded",we(he().m(function e(){var t;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,chrome.runtime.onMessage.addListener(function(e,t,n){return console.log("Popup received message:",e.action),"autoLockVault"===e.action&&(console.log("Auto-locking vault from popup"),X(),It("auth"),displayMessage(Ce,"Vault has been automatically locked for security.")),!0}),e.n=1,H();case 1:e.v?(ke.classList.add("active"),Oe.classList.remove("active"),Se.classList.remove("hidden"),je.classList.add("hidden")):(ke.classList.remove("active"),Oe.classList.add("active"),Se.classList.add("hidden"),je.classList.remove("hidden")),Bt(function(){var e=we(he().m(function e(t){return he().w(function(e){for(;;)switch(e.n){case 0:t&&t.url&&(Qe.value=t.url);case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),e.n=3;break;case 2:e.p=2,t=e.v,console.error("Initialization error:",t),xt(Ce,"Failed to initialize the application.");case 3:return e.a(2)}},e,null,[[0,2]])}))),ke.addEventListener("click",function(){ke.classList.add("active"),Oe.classList.remove("active"),Se.classList.remove("hidden"),je.classList.add("hidden")}),Oe.addEventListener("click",function(){ke.classList.remove("active"),Oe.classList.add("active"),Se.classList.add("hidden"),je.classList.remove("hidden")}),Le.addEventListener("click",we(he().m(function e(){var t,n,r,o,a,c,i;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=Pe.value){e.n=1;break}return xt(Ce,"Please enter your master password."),e.a(2);case 1:return e.p=1,e.n=2,W(t);case 2:if(!e.v){e.n=14;break}return n=5,e.p=3,e.n=4,x("user-settings");case 4:if(r=e.v,console.log("🔧 Popup: Retrieved user settings:",r),!r){e.n=5;break}!1===r.autoLockEnabled?n=0:r.autoLockTime>0&&(n=r.autoLockTime),e.n=7;break;case 5:return console.log("🔧 Popup: No user settings found, using defaults"),o={id:"user-settings",autoLockEnabled:!0,autoLockTime:5},e.n=6,P(o);case 6:console.log("🔧 Popup: Saved default settings");case 7:console.log("🔧 Popup: Using auto-lock timeout: ".concat(n," minutes")),e.n=9;break;case 8:e.p=8,a=e.v,console.error("🔧 Error getting user settings for auto-lock:",a),n=5;case 9:return e.p=9,console.log("🔧 Popup: Sending unlock message to background with lockAfterMinutes:",n),e.n=10,new Promise(function(e,r){chrome.runtime.sendMessage({action:"unlockVault",masterPassword:t,lockAfterMinutes:n},function(t){if(console.log("🔧 Popup: Background response:",t),chrome.runtime.lastError)return console.log("🔧 Popup: Runtime error:",chrome.runtime.lastError),e();e()})});case 10:e.n=12;break;case 11:e.p=11,c=e.v,console.error("🔧 Popup: Error sending message to background:",c);case 12:return Pe.value="",Ce.classList.add("hidden"),e.n=13,wt();case 13:e.n=15;break;case 14:xt(Ce,"Incorrect master password.");case 15:e.n=17;break;case 16:e.p=16,i=e.v,console.error("Unlock error:",i),xt(Ce,"Failed to unlock the vault.");case 17:return e.a(2)}},e,null,[[9,11],[3,8],[1,16]])}))),Be.addEventListener("click",we(he().m(function e(){var t,n,r;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=Ie.value,n=xe.value,t){e.n=1;break}return xt(Ae,"Please enter a master password."),e.a(2);case 1:if(!(t.length<8)){e.n=2;break}return xt(Ae,"Master password must be at least 8 characters."),e.a(2);case 2:if(t===n){e.n=3;break}return xt(Ae,"Passwords do not match."),e.a(2);case 3:return e.p=3,e.n=4,z(t);case 4:if(!e.v){e.n=6;break}return Ie.value="",xe.value="",Ae.classList.add("hidden"),e.n=5,wt();case 5:e.n=7;break;case 6:xt(Ae,"Failed to create the vault.");case 7:e.n=9;break;case 8:e.p=8,r=e.v,console.error("Setup error:",r),xt(Ae,"Failed to create the vault.");case 9:return e.a(2)}},e,null,[[3,8]])}))),Ge.addEventListener("input",function(){var e=Ge.value.toLowerCase();Te.querySelectorAll(".credential-item").forEach(function(t){var n=t.querySelector(".title").textContent.toLowerCase(),r=t.querySelector(".username").textContent.toLowerCase();n.includes(e)||r.includes(e)?t.style.display="block":t.style.display="none"})}),ze.addEventListener("click",function(){"••••••••"===Re.textContent?(Re.textContent=Re.dataset.password,ze.textContent="Hide"):(Re.textContent="••••••••",ze.textContent="Show")}),qe.addEventListener("click",function(){Lt(Ve.textContent),qe.textContent="Copied!",setTimeout(function(){qe.textContent="Copy"},1500)}),Ke.addEventListener("click",function(){Lt(Re.dataset.password),Ke.textContent="Copied!",setTimeout(function(){Ke.textContent="Copy"},1500)}),$e.addEventListener("click",function(){var e;gt=!0,Ze.textContent="Edit Credential",Qe.value=Ue.textContent,Xe.value=(null===(e=ht.find(function(e){return e.id===bt}))||void 0===e?void 0:e.name)||"",Ye.value=Ve.textContent,et.value=Re.dataset.password,tt.value=Je.textContent,It(Ee.form)}),He.addEventListener("click",we(he().m(function e(){var t;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!confirm("Are you sure you want to delete this credential?")){e.n=5;break}return e.p=1,e.n=2,ie(bt);case 2:return Me.click(),e.n=3,kt();case 3:e.n=5;break;case 4:e.p=4,t=e.v,console.error("Delete error:",t);case 5:return e.a(2)}},e,null,[[1,4]])}))),Me.addEventListener("click",function(){It(Ee.dashboard)}),_e.addEventListener("click",function(){gt=!1,Ze.textContent="Add Credential",Qe.value="",Xe.value="",Ye.value="",et.value="",tt.value="",Bt(function(e){e&&e.url&&(Qe.value=e.url)}),It(Ee.form)}),We.addEventListener("click",function(){It(gt?Ee.detail:Ee.dashboard)}),ot.addEventListener("click",we(he().m(function e(){var t,n,r,o,a,c,i;return he().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t=Qe.value,n=Xe.value,r=Ye.value,o=et.value,a=tt.value,t){e.n=1;break}return xt(at,"Please enter a URL."),e.a(2);case 1:if(o){e.n=2;break}return xt(at,"Please enter a password."),e.a(2);case 2:if(c={url:t,name:n,username:r,password:o,notes:a},!gt){e.n=4;break}return e.n=3,te(bt,c);case 3:e.n=5;break;case 4:return e.n=5,Y(c);case 5:return It(Ee.dashboard),e.n=6,kt();case 6:e.n=8;break;case 7:e.p=7,i=e.v,console.error("Save error:",i),xt(at,"Failed to save credential.");case 8:return e.a(2)}},e,null,[[0,7]])}))),nt.addEventListener("click",function(){It(Ee.passwordGenerator),Pt()}),rt.addEventListener("click",function(){"password"===et.type?(et.type="text",rt.textContent="🔒"):(et.type="password",rt.textContent="👁️")}),Ne.addEventListener("click",function(){X(),It(Ee.auth)}),De.addEventListener("click",function(){chrome.runtime.openOptionsPage()}),it.addEventListener("input",function(){ut.textContent=it.value}),mt.addEventListener("click",function(){Pt()}),yt.addEventListener("click",function(){et.value=pt.value,It(Ee.form)}),ct.addEventListener("click",function(){It(Ee.form)}),vt.addEventListener("click",function(){Lt(pt.value),vt.textContent="✓",setTimeout(function(){vt.textContent="📋"},1500)})})();