console.log("ï¿½ Service Worker starting fresh...");let autoLockTimer=null,vaultState="locked";function startAutoLock(o){console.log("â° === STARTING AUTO-LOCK TIMER ==="),console.log(`â° Duration: ${o} minutes`),autoLockTimer&&(console.log("â° Clearing existing timer with ID:",autoLockTimer),clearTimeout(autoLockTimer),autoLockTimer=null);const e=60*o*1e3;console.log(`â° Timer duration: ${e}ms`);const t=new Date,l=new Date(t.getTime()+e);console.log(`â° Current time: ${t.toLocaleTimeString()}`),console.log(`â° Will trigger at: ${l.toLocaleTimeString()}`),console.log(`â° That's ${Math.round(e/1e3)} seconds from now`),autoLockTimer=setTimeout(()=>{console.log("ï¿½ === AUTO-LOCK TRIGGERED ==="),console.log("ï¿½ Trigger time:",(new Date).toLocaleTimeString()),console.log("ğŸ”’ Previous vault state:",vaultState),vaultState="locked",autoLockTimer=null,console.log("ğŸ”’ New vault state:",vaultState),console.log("ğŸ”’ Timer cleared");try{chrome.runtime.sendMessage({action:"autoLockVault"},o=>{console.log("ğŸ”’ Popup notification response:",o)})}catch(o){console.log("ï¿½ No popup to notify (normal)")}console.log("ï¿½ === AUTO-LOCK COMPLETE ===")},e),console.log(`â° Timer set successfully with ID: ${autoLockTimer}`),console.log("â° === AUTO-LOCK TIMER ACTIVE ===")}function clearAutoLock(){console.log("ğŸš« === CLEARING AUTO-LOCK ==="),autoLockTimer?(console.log("ï¿½ Clearing timer with ID:",autoLockTimer),clearTimeout(autoLockTimer),autoLockTimer=null,console.log("ğŸš« Timer cleared successfully")):console.log("ğŸš« No timer to clear"),console.log("ï¿½ === CLEAR COMPLETE ===")}chrome.runtime.onMessage.addListener((o,e,t)=>{switch(console.log("ï¿½ Message received:",o.action),console.log("ğŸ“¨ Full message:",JSON.stringify(o,null,2)),console.log("ğŸ“¨ Current vault state:",vaultState),console.log("ğŸ“¨ Current timer status:",autoLockTimer?"ACTIVE":"INACTIVE"),o.action){case"unlockVault":console.log("ï¿½ === VAULT UNLOCK PROCESS ===");const e=o.minutes||o.lockAfterMinutes||5;console.log(`ğŸ”“ Unlocking vault with ${e} minute auto-lock`),vaultState="unlocked",startAutoLock(e),console.log("ğŸ”“ Vault unlock complete"),t({success:!0,state:vaultState});break;case"startAutoLock":console.log("â° === MANUAL AUTO-LOCK START ==="),startAutoLock(o.minutes||5),t({success:!0});break;case"lockVault":console.log("ï¿½ === VAULT LOCK PROCESS ==="),vaultState="locked",clearAutoLock(),console.log("ğŸ”’ Vault locked manually"),t({success:!0,state:vaultState});break;case"clearAutoLock":console.log("ğŸš« === CLEAR AUTO-LOCK ==="),clearAutoLock(),t({success:!0});break;case"getStatus":console.log("ğŸ“Š === STATUS CHECK ===");const l={vaultState,timerActive:!!autoLockTimer,timerId:autoLockTimer};console.log("ğŸ“Š Current status:",l),t(l);break;default:console.log("â“ Unknown action:",o.action),t({success:!0})}return!0}),console.log("âœ… Clean Service Worker ready"),console.log("âœ… Initial vault state:",vaultState),console.log("âœ… Initial timer status:",autoLockTimer?"ACTIVE":"INACTIVE");